<div class="wrap">
    <h1 class="wp-heading-inline">{{ __('Post-Processing Workflows', 'polytrans')|esc_html }}</h1>
    <a href="{{ admin_url('admin.php?page=polytrans-workflows&action=new')|esc_url }}" class="page-title-action">
        {{ __('Add New Workflow', 'polytrans')|esc_html }}
    </a>
    <hr class="wp-header-end">

    <div class="workflow-statistics">
        <div class="postbox">
            <h2 class="hndle">{{ __('Workflow Statistics', 'polytrans')|esc_html }}</h2>
            <div class="inside">
                <div class="workflow-stats-grid">
                    <div>
                        <strong>{{ __('Total Workflows:', 'polytrans')|esc_html }}</strong>
                        {{ statistics.total_workflows|esc_html }}
                    </div>
                    <div>
                        <strong>{{ __('Enabled:', 'polytrans')|esc_html }}</strong>
                        {{ statistics.enabled_workflows|esc_html }}
                    </div>
                    <div>
                        <strong>{{ __('Disabled:', 'polytrans')|esc_html }}</strong>
                        {{ statistics.disabled_workflows|esc_html }}
                    </div>
                </div>

                {% if statistics.languages|length > 0 %}
                    <div class="workflow-stats-languages">
                        <strong>{{ __('By Language:', 'polytrans')|esc_html }}</strong>
                        {% for lang, count in statistics.languages %}
                            <span class="workflow-lang-stat">
                                {{ lang|upper|esc_html }}: {{ count|esc_html }}
                            </span>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    {% if workflows|length == 0 %}
        <div class="notice notice-info">
            <p>
                {{ __('No workflows found.', 'polytrans')|esc_html }}
                <a href="{{ admin_url('admin.php?page=polytrans-workflows&action=new')|esc_url }}">
                    {{ __('Create your first workflow', 'polytrans')|esc_html }}
                </a>
            </p>
        </div>
    {% else %}
        <table class="widefat fixed striped">
            <thead>
                <tr>
                    <th class="workflow-col-name">{{ __('Name', 'polytrans')|esc_html }}</th>
                    <th class="workflow-col-language">{{ __('Language', 'polytrans')|esc_html }}</th>
                    <th class="workflow-col-steps">{{ __('Steps', 'polytrans')|esc_html }}</th>
                    <th class="workflow-col-status">{{ __('Status', 'polytrans')|esc_html }}</th>
                    <th class="workflow-col-description">{{ __('Description', 'polytrans')|esc_html }}</th>
                    <th class="workflow-col-actions">{{ __('Actions', 'polytrans')|esc_html }}</th>
                </tr>
            </thead>
            <tbody>
                {% for workflow in workflows %}
                    <tr data-workflow-id="{{ workflow.id|esc_attr }}">
                        <td>
                            <strong>{{ workflow.name|esc_html }}</strong>
                        </td>
                        <td>
                            {% set lang_index = null %}
                            {% for i, lang in langs %}
                                {% if lang == workflow.language %}
                                    {% set lang_index = i %}
                                {% endif %}
                            {% endfor %}
                            {% if lang_index is not null %}
                                {{ lang_names[lang_index]|esc_html }}
                            {% else %}
                                {{ workflow.language|upper|esc_html }}
                            {% endif %}
                        </td>
                        <td>
                            {{ (workflow.steps|default([]))|length|esc_html }}
                        </td>
                        <td>
                            {% if workflow.enabled|default(false) %}
                                <span class="workflow-status enabled">{{ __('Enabled', 'polytrans')|esc_html }}</span>
                            {% else %}
                                <span class="workflow-status disabled">{{ __('Disabled', 'polytrans')|esc_html }}</span>
                            {% endif %}
                        </td>
                        <td>
                            {{ (workflow.description|default(''))|esc_html }}
                        </td>
                        <td class="row-actions-visible">
                            <a href="{{ admin_url('admin.php?page=polytrans-workflows&action=edit&workflow_id=' ~ workflow.id|url_encode)|esc_url }}" class="button button-small">
                                {{ __('Edit', 'polytrans')|esc_html }}
                            </a>
                            <a href="{{ admin_url('admin.php?page=polytrans-workflows&action=test&workflow_id=' ~ workflow.id|url_encode)|esc_url }}" class="button button-small">
                                {{ __('Test', 'polytrans')|esc_html }}
                            </a>
                            {% set is_enabled = workflow.enabled|default(false) %}
                            <a href="{{ admin_url('admin.php?page=polytrans-execute-workflow&workflow_id=' ~ workflow.id|url_encode)|esc_url }}"
                                class="button button-small button-primary workflow-execute-btn"
                                {% if not is_enabled %}disabled aria-disabled="true"{% endif %}>
                                {{ __('Execute', 'polytrans')|esc_html }}
                            </a>
                            <button type="button" class="button button-small workflow-duplicate" data-workflow-id="{{ workflow.id|esc_attr }}">
                                {{ __('Duplicate', 'polytrans')|esc_html }}
                            </button>
                            <button type="button" class="button button-small button-link-delete workflow-delete" data-workflow-id="{{ workflow.id|esc_attr }}">
                                {{ __('Delete', 'polytrans')|esc_html }}
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

