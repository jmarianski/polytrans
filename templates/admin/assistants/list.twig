<div class="wrap">
    <h1 class="wp-heading-inline">{{ __('AI Assistants', 'polytrans') }}</h1>
    <a href="{{ polytrans_admin_url('polytrans-assistants&action=new') }}" class="page-title-action">
        {{ __('Add New', 'polytrans') }}
    </a>
    <hr class="wp-header-end">

    <p class="description">
        {{ __('Manage AI assistants for content processing, translation enhancement, and workflow automation.', 'polytrans') }}
    </p>

    {% if migration_status.migration_needed %}
        <div class="notice notice-warning">
            <p>
                <strong>{{ __('Migration Available:', 'polytrans') }}</strong>
                {% set steps_count = migration_status.ai_assistant_steps %}
                {{ __('Found %d legacy workflow steps that can be migrated to managed assistants.', 'polytrans')|replace({'%d': steps_count}) }}
            </p>
            <p>
                <button type="button" id="migrate-workflows-btn" class="button button-primary">
                    {{ __('Migrate Workflows Now', 'polytrans') }}
                </button>
                <span class="spinner" style="float: none; margin: 0 10px;"></span>
            </p>
        </div>
    {% endif %}

    {% if assistants is empty %}
        <div class="notice notice-info">
            <p>{{ __('No assistants found. Create your first assistant to get started!', 'polytrans') }}</p>
        </div>
    {% else %}
        <table class="wp-list-table widefat fixed striped">
            <thead>
                <tr>
                    <th scope="col" class="column-name">{{ __('Name', 'polytrans') }}</th>
                    <th scope="col" class="column-provider">{{ __('Provider', 'polytrans') }}</th>
                    <th scope="col" class="column-model">{{ __('Model', 'polytrans') }}</th>
                    <th scope="col" class="column-format">{{ __('Response Format', 'polytrans') }}</th>
                    <th scope="col" class="column-created">{{ __('Created', 'polytrans') }}</th>
                    <th scope="col" class="column-actions">{{ __('Actions', 'polytrans') }}</th>
                </tr>
            </thead>
            <tbody>
                {% for assistant in assistants %}
                    <tr>
                        <td class="column-name">
                            <strong>
                                <a href="{{ polytrans_admin_url('polytrans-assistants&action=edit&assistant_id=' ~ assistant.id) }}">
                                    {{ assistant.name|esc_html }}
                                </a>
                            </strong>
                        </td>
                        <td class="column-provider">
                            {% set provider_name = assistant.provider|capitalize %}
                            {% set is_provider_enabled = assistant.provider in enabled_providers %}
                            {% if not is_provider_enabled %}
                                <span style="color: #dc3232; font-weight: bold;">{{ provider_name|esc_html }}</span>
                            {% else %}
                                {{ provider_name|esc_html }}
                            {% endif %}
                        </td>
                        <td class="column-model">
                            {% if assistant.model %}
                                {{ assistant.model|esc_html }}
                            {% else %}
                                {% if assistant.has_default_model %}
                                    <span style="color: #666; font-style: italic;">{{ __('default', 'polytrans') }}</span>
                                {% else %}
                                    <span style="color: #dc3232; font-weight: bold;">{{ __('default', 'polytrans') }}</span>
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="column-format">
                            {% if assistant.response_format %}
                                {{ assistant.response_format|capitalize|esc_html }}
                            {% else %}
                                <span style="color: #666; font-style: italic;">{{ __('default', 'polytrans') }}</span>
                            {% endif %}
                        </td>
                        <td class="column-created">
                            {% if assistant.created_at %}
                                {{ mysql2date(get_option('date_format'), assistant.created_at)|esc_html }}
                            {% else %}
                                â€”
                            {% endif %}
                        </td>
                        <td class="column-actions">
                            <a href="{{ polytrans_admin_url('polytrans-assistants&action=edit&assistant_id=' ~ assistant.id) }}" class="button button-small">
                                {{ __('Edit', 'polytrans') }}
                            </a>
                            <button type="button" class="button button-small button-link-delete assistant-delete" data-assistant-id="{{ assistant.id|esc_attr }}">
                                {{ __('Delete', 'polytrans') }}
                            </button>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}
</div>

