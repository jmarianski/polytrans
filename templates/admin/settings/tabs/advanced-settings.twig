{% set transport_mode = settings.translation_transport_mode|default('external') %}
{% set method = settings.translation_receiver_secret_method|default('header_bearer') %}

<h1>{{ __('Advanced Integration Settings', 'polytrans') }}</h1>

<h2>{{ __('Transport Options', 'polytrans') }}</h2>
<select name="translation_transport_mode" style="width:100%">
    <option value="external" {{ selected(transport_mode, 'external') }}>{{ __('External Server (Default)', 'polytrans') }}</option>
    <option value="internal" {{ selected(transport_mode, 'internal') }}>{{ __('Internal (Local Endpoint)', 'polytrans') }}</option>
</select>
<div style="margin-top:8px;">
    <small>
        {{ __('Choose how to handle translation transport:', 'polytrans') }}<br>
        <strong>{{ __('External Server:', 'polytrans') }}</strong> {{ __('Sends data to the external endpoints specified below and expects the server to send data back to the specified receiver endpoint.', 'polytrans') }}<br>
        <strong>{{ __('Internal:', 'polytrans') }}</strong> {{ __('Uses spawned processes to stay in the same server and achieve asynchronity. May not work in certain environments.', 'polytrans') }}
    </small>
</div><br><br>

<h2>{{ __('Translation Endpoint', 'polytrans') }}</h2>
<input type="url" name="translation_endpoint" value="{{ translation_endpoint|esc_attr }}" style="width:100%" placeholder="https://example.com/translate-endpoint" />
<br><small>{{ __('Specify the URL of the translation endpoint. The system will send JSON with source_language, target_language, title, and text to this endpoint.', 'polytrans') }}</small><br><br>

<h2>{{ __('Translation Receiver Endpoint', 'polytrans') }}</h2>
<input type="url" name="translation_receiver_endpoint" value="{{ translation_receiver_endpoint|esc_attr }}" style="width:100%" placeholder="https://example.com/receive-endpoint" />
<br><small>{{ __('Specify the URL of the translation receiver endpoint. This is where translated data will be sent (e.g., http://localhost:9008/wp-json/polytrans/v1/translation/receive-post).', 'polytrans') }}</small><br><br>

<h2>{{ __('Translation Receiver Secret', 'polytrans') }}</h2>
<div style="display:flex;gap:0.5em;align-items:center;max-width:600px;">
    <input type="text" id="translation-receiver-secret" name="translation_receiver_secret" value="{{ settings.translation_receiver_secret|default('')|esc_attr }}" data-initial="{{ settings.translation_receiver_secret|default('')|esc_attr }}" style="width:100%" placeholder="{{ __('Enter secret for receiver authentication', 'polytrans')|esc_attr }}" autocomplete="off" />
    <button type="button" id="generate-translation-secret" class="button" style="white-space:nowrap;">{{ __('Generate Secret', 'polytrans') }}</button>
</div>
<br><small>{{ __('This secret will be used to authenticate translation requests. Keep it private!', 'polytrans') }}</small><br><br>

<h2>{{ __('How to Pass Secret', 'polytrans') }}</h2>
<select name="translation_receiver_secret_method" style="width:100%">
    <option value="none" {{ selected(method, 'none') }}>{{ __('None (do not send secret)', 'polytrans') }}</option>
    <option value="get_param" {{ selected(method, 'get_param') }}>{{ __('GET parameter (?secret=...)', 'polytrans') }}</option>
    <option value="header_bearer" {{ selected(method, 'header_bearer') }}>{{ __('HTTP Header: Authorization: Bearer ...', 'polytrans') }}</option>
    <option value="header_custom" {{ selected(method, 'header_custom') }}>{{ __('HTTP Header: Custom Header Name', 'polytrans') }}</option>
    <option value="post_param" {{ selected(method, 'post_param') }}>{{ __('POST body field (JSON: secret)', 'polytrans') }}</option>
</select>
<br><small>{{ __('Choose how the secret should be sent to the receiver endpoint. Select "None" to disable secret sending/checking.', 'polytrans') }}</small><br><br>

<div id="custom-header-section" style="{{ method != 'header_custom' ? 'display:none;' : '' }}">
    <h2>{{ __('Custom Header Name', 'polytrans') }}</h2>
    <input type="text" name="translation_receiver_secret_custom_header" value="{{ settings.translation_receiver_secret_custom_header|default('x-polytrans-secret')|esc_attr }}" style="width:100%;max-width:400px;" placeholder="x-polytrans-secret" />
    <br><small>{{ __('Specify the custom header name to use when sending the secret. Default is "x-polytrans-secret".', 'polytrans') }}</small><br><br>
</div>

<h2>{{ __('Edit Link Base URL', 'polytrans') }}</h2>
<input type="url" name="edit_link_base_url" value="{{ settings.edit_link_base_url|default('')|esc_attr }}" style="width:100%" placeholder="https://example.com/wp-admin" />
<br><small>{{ __('Base URL for edit links in email notifications (e.g., https://example.com/wp-admin). If left empty, the system will attempt to use the default WordPress admin URL. This is useful when notifications are sent from background processes or external services that don\'t have proper WordPress context.', 'polytrans') }}</small><br><br>

<h2>{{ __('Logging Options', 'polytrans') }}</h2>
<div class="translation-logging-options">
    {% set enable_db_logging = settings.enable_db_logging|default(true) %}
    <p>
        <input type="checkbox" id="enable-db-logging" name="enable_db_logging" value="1" {{ checked(enable_db_logging) }}>
        <label for="enable-db-logging"><strong>{{ __('Enable Database Logging', 'polytrans') }}</strong></label>
    </p>
    <small>
        {{ __('When enabled, logs will be stored in the database table. When disabled, logs will only be written to the WordPress error log and post meta. Disabling database logging can improve performance and reduce database size, but makes viewing logs from the admin panel more limited. Warning: Logs from internal processes can only log to database, will never show up in stderr.', 'polytrans') }}
    </small>
</div><br>

